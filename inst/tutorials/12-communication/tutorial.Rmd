---
title: Communication
author: David Kane and Srihith Garlapati
tutorial:
  id: communication
output:
  learnr::tutorial:
    progressive: yes
    allow_skip: yes
runtime: shiny_prerendered
description: 'Tutorial for Chapter 12: Communication'
---

```{r setup, include = FALSE}
library(learnr)
library(tutorial.helpers)
library(tidyverse)
library(primer.data)
library(ggthemes)
library(plotly)
library(ggdist)
library(babynames)
library(scales)
library(ggrepel)
library(patchwork)
library(skimr)
knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 60, 
        tutorial.storage = "local") 

labels_tib <- tibble(
  x = 1:10,
  y = cumsum(x^2)
)

labels_graphic = ggplot(mpg, aes(x = displ, y = hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  labs(
    x = "Engine displacement (L)",
    y = "Highway fuel economy (mpg)",
    color = "Car type",
    title = "Fuel efficiency generally decreases with engine size",
    subtitle = "Two seaters (sports cars) are an exception because of their light weight",
    caption = "Data from fueleconomy.gov"
  )

label_info <- mpg |>
  arrange(desc(displ)) |>
  slice_head(n = 1, by = drv) |>
  mutate(
    drive_type = case_when(
      drv == "f" ~ "front-wheel drive",
      drv == "r" ~ "rear-wheel drive",
      drv == "4" ~ "4-wheel drive"
    )
  ) |>
  select(displ, hwy, drv, drive_type)

potential_outliers <- mpg |>
  filter(hwy > 40 | (hwy > 20 & displ > 5))

trend_text <- "Larger engine sizes tend to have lower fuel economy." |>
  str_wrap(width = 30)

base <- ggplot(mpg, aes(x = displ, y = hwy)) +
  geom_point(aes(color = class))
```

```{r copy-code-chunk, child = system.file("child_documents/copy_button.Rmd", package = "tutorial.helpers")}
```

```{r info-section, child = system.file("child_documents/info_section.Rmd", package = "tutorial.helpers")}
```

<!-- DK: Don't paste all the lines in the pipe in the hint. Just give the new code: -->

<!-- ... |>  -->
<!--   new_code(this) -->

<!-- DK: Delete most uses of "Use your previous code". Raises the question, what is the CP/CR equivalent of "Continue the pipe"? -->

## Introduction
### 

This tutorial covers [Chapter 12: Communication](https://r4ds.hadley.nz/communication.html)  from [*R for Data Science (2e)*](https://r4ds.hadley.nz/) by Hadley Wickham, Mine Çetinkaya-Rundel, and Garrett Grolemund. In this tutorial we will be making use of three core packages from *ggplot2*: [**scales**](https://scales.r-lib.org/) to override the default breaks, [**ggrepel**](https://ggrepel.slowkow.com), and [**patchwork**](https://patchwork.data-imaginist.com). Some key commands that you will be making use of are [`quote()`](https://rdrr.io/r/base/substitute.html) which simply returns its argument, [`geom_label_repel()`](https://rdrr.io/cran/ggrepel/man/geom_text_repel.html) which adds text directly to the plot, and [`label_dollar()`](https://scales.r-lib.org/reference/label_dollar.html) which formats numbers as currency. 

## Labels
### 

In this section, you will learn that good labels makes for a great graphic. By the end of this section, we will have learnt how to make an exploratory graphic into an expository graphic. 

### 

By the end of this section we should have this great expository plot:

```{r include = TRUE}
labels_graphic
```

### Exercise 1

Let's first load in the package **tidyverse** using the `library()` function. 

```{r labels-1, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r labels-1-hint-1, eval = FALSE}
library(...)
```

### 

Let's start with the basics and make a plot with well-formatted labels.

### Exercise 2

Now, let's explore the dataset that we want to create a plot on. Type in `mpg` and hit "Run Code". 

```{r labels-2, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r labels-2-hint-1, eval = FALSE}
mpg
```

### 

The `mpg` dataset provides fuel economy data from 1999 and 2008 for 38 popular models of cars. The dataset is shipped with [**ggplot2**](https://ggplot2.tidyverse.org/) package.

### Exercise 3

Create a new pipeline. Pipe `mpg` to the `ggplot()` function. Within the `ggplot()` function, map `x` to the `displ` variable and `y` to the hwy variable using the `aes()` function.

```{r labels-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r labels-3-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...))
```

### 

### Exercise 4

Using your previous code, add the `geom_point()` function to the pipeline.

```{r labels-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r labels-4-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point()
```

### Exercise 5

Using your previous code, within the `geom_point()` function, map the argument `color` to the variable `class` using the `aes()` function. 

```{r labels-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r labels-5-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point(aes(color = ...))
```

### 

Now that we have a basic dot plot. We need to add a trend line that can allow us to see the trend of the points very clearly.

### Exercise 6

Using your previous code, add the `geom_smooth()` function to the pipeline.

```{r labels-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r labels-6-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point(aes(color = ...)) +
  geom_smooth()
```

### Exercise 7

Using your previous code, within your call to the function `geom_smooth()` add the argument called `se` and set it to `FALSE`. This removes the gray background of the line.

```{r labels-7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r labels-7-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point(aes(color = ...)) +
  geom_smooth(se = ...)
```

### 

Our graphic is currently exploratory, let's turn it into an expository graphic with some good labels.

### Exercise 8

Using your previous code, add a `labs()` function to the pipeline and add a `title`, `subtitle`, `x` axis title, `y` axis title, `color` title, and a `caption`. 

(Hint the `caption` should be the following: `"Data from fueleconomy.gov"`)

```{r labels-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r labels-8-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point(aes(color = ...)) +
  geom_smooth(se = ...) +
  labs(
    title = ...,
    subtitle = ...,
    x = ...,
    y = ...,
    color = ...,
    caption = ...
  )
```

### 

The purpose of a plot title is to summarize the main finding. Avoid titles that just describe what the plot is, e.g., “A scatterplot of engine displacement vs. fuel economy”. The argument, `subtitle`, adds additional detail in a smaller font beneath the `title` and the argument, `caption`, adds text at the bottom right of the plot, often used to describe the source of the data.

### 

Reminder: The graphic should look something like this

```{r include = TRUE}
labels_graphic
```

### Exercise 9

It’s also possible to use mathematical equations instead of text strings. Let's take a look at a tibble called `labels_tib`. Type in `labels_tib` and hit "Run Code". 

```{r labels-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r labels-9-hint-1, eval = FALSE}
labels_tib
```

### 

We can use mathematical equations instead of textstrings for the labels if we switch `""` for the function `quote()`

### Exercise 10

Create a new pipeline. Pipe `labels_tib` to the function `ggplot()`. Within this function, map `x` to `x` and `y` to `y` using the `aes()` function.

```{r labels-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r labels-10-hint-1, eval = FALSE}
labels_tib |> 
  ggplot(aes(x = ..., y = ...))
```

### 

### Exercise 11

Using your previous code, add the `geom_point()` function to the pipeline.

```{r labels-11, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r labels-11-hint-1, eval = FALSE}
labels_tib |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point()
```

### Exercise 12

Using your previous code, add the `labs()` function to the pipeline. Within the `labs()` function, set the `x` axis title to `quote(x[i])`.

```{r labels-12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r labels-12-hint-1, eval = FALSE}
labels_tib |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  labs(
    x = ...
  )
```

### 

### Exercise 13

Using your previous code, within your call to the `labs()` function add the `y` axis title and set it to `quote(sum(x[i] ^ 2, i == 1, n))`. 

```{r labels-13, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r labels-13-hint-1, eval = FALSE}
labels_tib |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  labs(
    x = ...,
    y = ...
  )
```

### Exercise 14

Type in `?plotmath` in the Console and learn more about what kind of syntax you can input into the `quote()` function. Copy/paste an interesting syntax and a meaning to the textbox below and hit "Submit".

```{r labels-14}
question_text(NULL,
	message = "Place correct answer here.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

## Annotations
### 

<!-- DK: Build the whole plot as a pipe first so that results are vomitted out with each exercise. Then, if necessary at the end, you can assign it to an object.  -->

In this section we will learn how to label an individual observation or a group of observations instead of just labelling major components of a plot. 

### Exercise 1

Load in the `ggrepel` package using the `library()` function.

```{r annotations-1, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-1-hint-1, eval = FALSE}
library(...)
```

### Exercise 2

Let's make a new dataframe called `label_info` and set it to equal the dataset `mpg`.

```{r annotations-2, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-2-hint-1, eval = FALSE}
label_info <- mpg
```

### Exercise 3

Using your previous code, create a new pipeline. Pipe `mpg` to the `arrange()` function. Within this function, add the argument `desc(displ)`.

```{r annotations-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-3-hint-1, eval = FALSE}
label_info <- mpg |> 
  arrange(...)
```

### Exercise 4

Using your previous code, add the `slice_head()` function. Within this function set the argument `n` to `1`.

```{r annotations-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-4-hint-1, eval = FALSE}
label_info <- mpg |> 
  arrange(...) |> 
  slice_head(n = ...)
```

### 

### Exercise 5

Using your previous code, within your call to `slice_head()`, add a `by` argument and set it to `drv` (drivetype). 

```{r annotations-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-5-hint-1, eval = FALSE}
label_info <- mpg |> 
  arrange(...) |> 
  slice_head(n = ..., by = ...)
```

### 

The by argument will group by whatever is inputted into the argument. 

### Exercise 6

Using your previous code, add the `mutate()` function to the pipeline. Within this function, create a new variable called `drive_type` and set it to: 
`case_when(drv == "f" ~ "front-wheel drive", drv == "r" ~ "rear-wheel drive", drv == "4" ~ "4-wheel drive")`


```{r annotations-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-6-hint-1, eval = FALSE}
label_info <- mpg |> 
  arrange(...) |> 
  slice_head(n = ..., by = ...) |> 
  mutate(drive_type = case_when(...))
```

### Exercise 7

Using your previous code, add the `select()` function to the pipeline. Select the following columns: `displ`, `hwy`, `drv`, `drive_type`.

```{r annotations-7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-7-hint-1, eval = FALSE}
label_info <- mpg |> 
  arrange(...) |> 
  slice_head(n = ..., by = ...) |> 
  mutate(drive_type = case_when(...)) |> 
  select(...)
```

### 

So, far we have pulled out the cars with the highest engine size in each drive type and saved their information as a new data frame called `label_info`.

### Exercise 8

Display `label_info` by typing `label_info` below and hitting "Run Code".

```{r annotations-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-8-hint-1, eval = FALSE}
label_info
```

### 

We will now use this new data frame to directly label the three groups and replace the legend by placing labels directly on the plot. 

### Exercise 9

Create a new pipeline. Pipe `mpg` to the `ggplot()` function. Within this function, map `x` to `displ`, `y` to `hwy`, and `color` to `drv` using `aes()`.

```{r annotations-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-9-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...))
```

### Exercise 10

Using your previous code, add the `geom_point()` function to the pipeline. Within this function set the argument `alpha` to `0.3`.

```{r annotations-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-10-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...)) |> 
  geom_point(alpha = ...)
```

### Exercise 11

Using your previous code, add the `geom_smooth()` function to the pipeline. Within this function set the `se` argument to `FALSE`. 

```{r annotations-11, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-11-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...)) |> 
  geom_point(alpha = ...) |> 
  geom_smooth(se = ...)
```

### Exercise 12

Using your previous code, add the `geom_text()` function to the pipeline. Within this function set the argument `data` to the dataframe `label_info`. 

```{r annotations-12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-12-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...)) |> 
  geom_point(alpha = ...) |> 
  geom_smooth(se = ...) |> 
  geom_text(
    data = ...
  )
```

### 

This code chunk should have returned an error stating that it *requires the following missing aesthetics: label*. It returns an error because we haven't yet mapped the label argument to a variable in the dataframe.


### Exercise 13

Using your previous code, within your call to `geom_text()`, map `x` to `displ`, `y` to `hwy`, and `label` to `drive_type` using `aes()`.

```{r annotations-13, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-13-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...)) |> 
  geom_point(alpha = ...) |> 
  geom_smooth(se = ...) |> 
  geom_text(
    data = ..., 
    aes(...)
  )
```

### Exercise 14

Using your previous code, within your call to `geom_text()`, add the argument `fontface` and set it to `"bold"`. 

```{r annotations-14, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-14-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...)) |> 
  geom_point(alpha = ...) |> 
  geom_smooth(se = ...) |> 
  geom_text(
    data = ..., 
    aes(...), 
    fontface = ...
  )
```

### Exercise 15

Using your previous code, within your call to `geom_text()`, add the argument `size` and set it to `5`.

```{r annotations-15, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-15-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...)) |> 
  geom_point(alpha = ...) |> 
  geom_smooth(se = ...) |> 
  geom_text(
    data = ..., 
    aes(...), 
    fontface = ..., 
    size = ...
  )
```

### 

The `fontface` and `size` arguments we can customize the look of the text labels. In this case, these arguments make the labels larger than the rest of the text on the plot and bolded.

### Exercise 16

Using your previous code, within your call to `geom_text()` add the `hjust` and `vjust` arguments. Set the `hjust` argument to `"right"` and the `vjust` argument to `"bottom"`. 

```{r annotations-16, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-16-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...)) |> 
  geom_point(alpha = ...) |> 
  geom_smooth(se = ...) |> 
  geom_text(
    data = ..., 
    aes(...), 
    fontface = ..., 
    size = ...,
    hjust = ...,
    vjust = ...
  )
```

### 

Note the use of `hjust` (horizontal justification) and `vjust` (vertical justification) to control the alignment of the label.

### Exercise 17

Using your previous code, add the `theme()` function to the pipeline. Within this function, add the argument `legend.position` and set it to `"none"`. 

```{r annotations-17, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-17-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...)) |> 
  geom_point(alpha = ...) |> 
  geom_smooth(se = ...) |> 
  geom_text(
    data = ..., 
    aes(...), 
    fontface = ..., 
    size = ...
  ) |> 
  theme(legend.position = ...)
```

### 

The function `theme()` with the argument `legend.position = "none"` turns all the legends off — we’ll talk about it more shortly.)

### Exercise 18

Using your previous code, remove the `hjust` and `vjust` arguments from within the `geom_text()` function. In addition, change the `geom_text()` function to the `geom_label_repel()` function. 

```{r annotations-18, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r annotations-18-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...)) |> 
  geom_point(alpha = ...) |> 
  geom_smooth(se = ...) |> 
  geom_label_repel(
    data = ..., 
    aes(...), 
    fontface = ..., 
    size = ...
  ) + 
  theme(legend.position = ...)
```

### 

The annotated plot we made before is hard to read because the labels overlap with each other and with the points. We can use the `geom_label_repel()` function from the **ggrepel** package to address both of these issues. This useful package will automatically adjust labels so that they don’t overlap as you can see above.

## More Annotations
### 

In this section, we will discuss and learn more ways to add annotations to your plots.

### Exercise 1

Create a new variable called `potential_outliers` and set it equal to the dataset `mpg`. 

```{r more-annotations-1, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-1-hint-1, eval = FALSE}
potential_outliers <- mpg
```

### Exercise 2

Using your previous code, create a new pipeline and pipe `mpg` to the `filter()` function. Within this function add the following code: `hwy > 40 | (hwy > 20 & displ > 5)`. 

```{r more-annotations-2, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-2-hint-1, eval = FALSE}
potential_outliers <- mpg |> 
  filter(...)
```

### Exercise 3

Create a new pipeline. Pipe `mpg` to the `ggplot()` function. Within this function map `x` to `displ` and `y` to `hwy` using `aes()`. 

```{r more-annotations-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-3-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...))
```

### Exercise 4

Using your previous code, add the `geom_point()` function to the pipeline. 

```{r more-annotations-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-4-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point()
```

### Exercise 5

Using your previous code, add the `geom_text_repel()` function. Within this function add the argument `data` and set it to `potential_outliers`.

```{r more-annotations-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-5-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  geom_text_repel(data = ...)
```

### 

This code chunk should have returned an error stating that it *requires the following missing aesthetics: label*. It returns an error because we haven't yet mapped the label argument to a variable in the dataframe. 

### 

In addition to `geom_text()` and `geom_label()`, you have many other geoms in **ggplot2** available to help annotate your plot. For example, you can use `geom_hline()` and `geom_vline()` to add reference lines. We often make them thick (`linewidth = 2`) and white (`color = white`), and draw them underneath the primary data layer. That makes them easy to see, without drawing attention away from the data.

### Exercise 6

Using your previous code, within your call to `geom_text_repel()`, map `label` to `model` using `aes()`.

```{r more-annotations-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-6-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  geom_text_repel(data = ..., 
                  aes(label = ...))
```

### 

Another geom that can help annotate your plot is `geom_rect()`. You can use `geom_rect()` to draw a rectangle around points of interest. The boundaries of the rectangle are defined by aesthetics `xmin`, `xmax`, `ymin`, `ymax`. Alternatively, look into the [**ggforce**](https://ggforce.data-imaginist.com/) package, specifically [`geom_mark_hull()`](https://ggforce.data-imaginist.com/reference/geom_mark_hull.html), which allows you to annotate subsets of points with hulls.

### Exercise 7

Using your previous code, add the `geom_point()` function to the pipeline. Within this function, add the argument `data` and set it to `potential_outliers`. 

```{r more-annotations-7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-7-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  geom_text_repel(data = ..., 
                  aes(label = ...)) +
  geom_point(data = ...)
```

### 

You can use `geom_segment()` with the arrow argument to draw attention to a point with an arrow. Use aesthetics `x` and `y` to define the starting location, and `xend` and `yend` to define the end location. 

### Exercise 8

Using your previous code, within your most recent call to `geom_point()`, add the argument `color` and set it to `"red"`.

```{r more-annotations-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-8-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  geom_text_repel(data = ..., 
                  aes(label = ...)) +
  geom_point(data = ..., color = ...) 
```

### 

### Exercise 9

Using your previous code, add another `geom_point()` function to the pipeline. Within this function, add an argument called `data` and set it to `potential_outliers`. 

```{r more-annotations-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-9-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  geom_text_repel(data = ..., 
                  aes(label = ...)) +
  geom_point(data = ..., color = ...) +
  geom_point(data = ...)
```

### Exercise 10

Using your previous code, within your most previous call to geom_point(), add an argument called `color` and set it to `"red"`.

```{r more-annotations-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-10-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  geom_text_repel(data = ..., 
                  aes(label = ...)) +
  geom_point(data = ..., color = ...) +
  geom_point(data = ..., 
             color = ...)
```

### Exercise 11

Using your previous code, within your most previous call to the `geom_point()` function, add an argument called `size` and set it to `3`. 

```{r more-annotations-11, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-11-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  geom_text_repel(data = ..., 
                  aes(label = ...)) +
  geom_point(data = ..., color = ...) +
  geom_point(data = ..., 
             color = ...,
             size = ...)
```

### Exercise 12

Using your previous code, within your most previous call to the `geom_point()` function, add the `shape` argument and set it to `"circle open"`. 

```{r more-annotations-12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-12-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  geom_text_repel(data = ..., 
                  aes(label = ...)) +
  geom_point(data = ..., color = ...) +
  geom_point(data = ..., 
             color = ...,
             size = ..., 
             shape = ...)
```

### 

Note another handy technique used here: we added a second layer of large, hollow points to further highlight the labelled points.

### Exercise 13

Another handy function for adding annotations to plots is `annotate()`. As a rule of thumb, geoms are generally useful for highlighting a subset of the data while `annotate()` is useful for adding one or few annotation elements to a plot.

### 

Create a new variable called `trend_text` and set it to `"Larger engine sizes tend to have lower fuel economy."`

```{r more-annotations-13, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-13-hint-1, eval = FALSE}
trend_text <- ...
```

### 

To demonstrate using `annotate()`, let’s create some text to add to our plot. The text is a bit long, so we’ll use `stringr::str_wrap()` to automatically add line breaks to it given the number of characters you want per line.

### Exercise 14

Using your previous code, create a new pipeline and pipe `trend_text` with the `str_wrap()` function. Within this function add an argument called `width` and set it to `30`. 

```{r more-annotations-14, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-14-hint-1, eval = FALSE}
trend_text <- ... |> 
  str_wrap(width = ...)
```

### Exercise 15

Now let's make use of this annotation within a plot. Create a new pipeline and pipe `mpg` to the `ggplot()` function. Within this function map `x` to `displ` and `y` to `hwy` using `aes()`.

```{r more-annotations-15, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-15-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...))
```

### Exercise 16

Using your previous code, add the `geom_point()` function to the pipeline.

```{r more-annotations-16, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-16-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point()
```

### 

### Exercise 17

Using your previous code, add the `annotate()` function to the pipeline. Within this function set the argument `geom` to `"label"`, `x` to `3.5`, and `y` to `38`. 
 
```{r more-annotations-17, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-17-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  annotate(
    geom = ...,
    x = ..., 
    y = ...
  )
```

### 

This code chunk should have returned an error stating that it *requires the following missing aesthetics: label*. It returns an error because we haven't yet mapped the label argument to a variable in the dataframe. Now let's end the annotation about the trend into the plot while mapping the label argument.

### Exercise 18

Using your previous code, within your most recent call to the `annotate()` function, add the argument `label` and set it to `trend_text`. 

```{r more-annotations-18, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-18-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  annotate(
    geom = ...,
    x = ..., 
    y = ...,
    label = trend_text
  )
```

### 

Now, let's alighn it horizontally using the argument `hjust`. 

### Exercise 19

Using your previous code, within your most recent call to the `annotate()` function, add the arguments `hjust` and set it to `"left"` and `color` and set it to `"red"`.

```{r more-annotations-19, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r more-annotations-19-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  annotate(
    geom = ...,
    x = ..., 
    y = ...,
    label = ..., 
    hjust = ...,
    color = ...
  )
```

### 

Annotation is a powerful tool for communicating main takeaways and interesting features of your visualizations. The only limit is your imagination (and your patience with positioning annotations to be aesthetically pleasing)!

## Scales
### 

In this section, we will learn about how to display plots more appropriately by using scales.

### Exercise 1

First load in the package **scales** using the `library()` function.

```{r scales-1, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-1-hint-1, eval = FALSE}
library(...)
```

### 

The most common use of the scales package is to customise to control the appearance of axis and legend labels. Use a break_ function to control how breaks are generated from the limits, and a label_ function to control how breaks are turned in to labels.

### Exercise 2

When you make a regular plot, **ggplot2* automatically adds scales for you. Let's make a simple plot to demonstrate this.

### 

Create a new pipeline and pipe `mpg` to the `ggplot()` function. Within this function map `x` to `displ` and `y` to `hwy` using `aes()`. 

```{r scales-2, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-2-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...))
```

### Exercise 3

Using your previous code, add the `geom_point()` function to the pipeline. Within this function map the argument `color` to `class` using `aes()`.

```{r scales-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-3-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) + 
  geom_point(aes(color = ...))
```

### 

**ggplot2** automatically adds default scales behind the scenes such as `scale_x_continuous()`, `scale_y_continuous()`, and `scale_color_discrete()`.

### Exercise 4

We can test this previous statement, by adding those functions at the end of our previous pipeline. 

### 

Using your previous code, add the `scale_x_continuous()`, `scale_y_continuous()`, and the `scale_color_discrete()` functions to the pipeline. 

```{r scales-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-4-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ...)) + 
  geom_point(aes(color = ...)) +
  scale_x_continuous() +
  ... +
  scale_color_discrete()
```

### 

We can see that the two data frames are the same. Note the naming scheme for scales: scale_ followed by the name of the aesthetic, then _, then the name of the scale. The default scales are named according to the type of variable they align with: continuous, discrete, datetime, or date.

### Exercise 5

Create a new pipeline and pipe `mpg` to the `ggplot()` function. Within this function, map `x` to `displ`, `y` to `hwy`, and `color` to `drv` using `aes()`. 

```{r scales-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-5-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...))
```

### 

There are two primary arguments that affect the appearance of the ticks on the axes and the keys on the legend: `breaks` and `labels`. Breaks controls the position of the ticks, or the values associated with the keys.

### Exercise 6

Using your previous code, add the `scale_y_continuous()` function to the pipeline. Within this function add the `breaks` argument and set it to `seq(15, 40, by = 5)`.

```{r scales-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-6-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...)) +
  scale_y_continuous(breaks = ...)
```

### 

Labels controls the text label associated with each tick/key. The most common use of `breaks` is to override the default choice.

### Exercise 7

Create a new pipeline and pipe `mpg` to the `ggplot()` function. Within this function map `x` to `displ`, `y` to `hwy`, and `color` to `drv` using `aes()`

```{r scales-7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-7-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...))
```

### 

You can use labels in the same way (a character vector the same length as breaks), but you can also set it to NULL to suppress the labels altogether. This can be useful for maps, or for publishing plots where you can’t share the absolute numbers.

### Exercise 8

Using your previous code, add the `geom_point()` function to the pipeline.

```{r scales-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-8-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...)) +
  geom_point()
```

### Exercise 9

Using your previous code, add the `scale_x_continuous()` function to the pipeline. Within this function, add the `labels` argument and set it to `NULL`. 

```{r scales-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-9-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...)) +
  geom_point() +
  scale_x_continuous(labels = ...)
```

### Exercise 10

Using your previous code, add the `scale_y_continuous()` function to the pipeline. Within this function, add the `labels` argument and set it to `NULL`. 

```{r scales-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-10-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...)) +
  geom_point() +
  scale_x_continuous(labels = ...) +
  scale_y_continuous(labels = ...)
```

### Exercise 11

Using your previous code, add the `scale_color_discrete()` function to the pipeline. Within this function, add the `labels` argument and set it to `c("4" = "4-wheel", "f" = "front", "r" = "rear")`. 

```{r scales-11, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-11-hint-1, eval = FALSE}
mpg |> 
  ggplot(aes(x = ..., y = ..., color = ...)) +
  geom_point() +
  scale_x_continuous(labels = ...) +
  scale_y_continuous(labels = ...) +
  scale_color_discrete(labels = ...)
```

### 

You can also use breaks and labels to control the appearance of legends. For discrete scales for categorical variables, labels can be a named list of the existing levels names and the desired labels for them.

### Exercise 12

This time we will be using the **scales** package to create more efficient axis labels. Create a new pipeline and pipe `diamonds` to the `ggplot()` function. Within this function, pipe map `x` to `price` and `y` to `cut`.

```{r scales-12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-12-hint-1, eval = FALSE}
diamonds |> 
  ggplot(aes(x = ..., y = ...))
```

### Exercise 13

Using your previous code, add the `geom_boxplot()` function to the pipeline. Within this function add the `alpha` argument and set it to `0.05`. 

```{r scales-13, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-13-hint-1, eval = FALSE}
diamonds |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_boxplot(alpha = ...)
```

### Exercise 14

Using your previous code, add the `scale_x_continuous()` function. Within this function add the `labels` argument and set it equal to the `label_dollar()` function.

```{r scales-14, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-14-hint-1, eval = FALSE}
diamonds |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_boxplot(alpha = ...) +
  scale_x_continuous(labels = ...)
```

### 

The `labels` argument coupled with labelling functions from the **scales** package is also useful for formatting numbers as currency, percent, etc. The plot shows default labelling with `label_dollar()`, which adds a dollar sign as well as a thousand separator comma.

### Exercise 15

Another handy label function is `label_percent()`. Create a new pipeline and pipe `diamonds` to the `ggplot()` function. Within this function, map `x` to `cut` and `fill` to `clarity`.

```{r scales-15, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-15-hint-1, eval = FALSE}
diamonds |> 
  ggplot(aes(x = ..., fill = ...))
```

### Exercise 16

Using your previous code, add the `geom_bar()` function. Within this function add the `position` argument and set it equal to `"fill"`. 

```{r scales-16, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-16-hint-1, eval = FALSE}
diamonds |> 
  ggplot(aes(x = ..., fill = ...)) +
  geom_bar(position = ...)
```

### Exercise 17

Using your previous code, add the `scale_y_continuous()` function to the pipeline. Within this function, add the `name` argument and set equal to `"Percentage"` and add the `labels` argument and set it equal to `label_percent()`. 

```{r scales-17, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-17-hint-1, eval = FALSE}
diamonds |> 
  ggplot(aes(x = ..., fill = ...)) +
  geom_bar(position = ...) +
  scale_y_continuous(name = ..., labels = ...)
```

### Exercise 18

Type in `presidential` and hit "Run Code".

```{r scales-18, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-18-hint-1, eval = FALSE}
presedential
```

### 

The dataset, `presidential` gives the names of each president, the start and end date of their term, and their party of 12 US presidents from Eisenhower to Trump. This data is in the public domain.

### Exercise 19

Create a new pipeline and pipe `presidential` to the `mutate()` function. Within this function, create a new variable `id` and set it equal to `33` plus `row_number()`.

```{r scales-19, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-19-hint-1, eval = FALSE}
presidential |> 
  mutate(id = ...)
```

### Exercise 20

Using your previous code, add the `ggplot()` function to the pipeline. Within this function, map `x` to `start` and `y` to `id` using `aes()`. 

```{r scales-20, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-20-hint-1, eval = FALSE}
presidential |> 
  mutate(id = ...) |> 
  ggplot(aes(x = ..., y = ...))
```

### Exercise 21

Using your previous code, add the `geom_point()` function to the pipeline. 

```{r scales-21, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-21-hint-1, eval = FALSE}
presidential |> 
  mutate(id = ...) |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point()
```

### Exercise 22

Using your previous code, add the `geom_segment()` function. Within this function, map `xend` to `end` and `yend` to `id`.

```{r scales-22, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-22-hint-1, eval = FALSE}
presidential |> 
  mutate(id = ...) |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  geom_segment(aes(xend = ..., yend = ...))
```

### 

Another use of breaks is when you have relatively few data points and want to highlight exactly where the observations occur.

### Exercise 23

Using your previous code, add the `scale_x_date()` function. Within this function add the argument `name` and set it equal to `NULL`.

```{r scales-23, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-23-hint-1, eval = FALSE}
presidential |> 
  mutate(id = ...) |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  geom_segment(aes(xend = ..., yend = ...)) +
  scale_x_date(name = ...)
```

### Exercise 24

Using your previous code, within your call to the function `scale_x_date()`, add the argument `breaks` and set it equal to `presidential$start`.

```{r scales-24, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-24-hint-1, eval = FALSE}
presidential |> 
  mutate(id = ...) |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point() +
  geom_segment(aes(xend = ..., yend = ...)) +
  scale_x_date(name = ..., breaks = ...)
```

### 

Note that for the breaks argument we pulled out the start variable as a vector with presidential$start because we can’t do an aesthetic mapping for this argument. Also note that the specification of breaks and labels for date and datetime scales is a little different:

### Exercise 25

Using your previous code, within your call to the function `scale_x_date()`, add the argument `date_labels` and set it equal to `"'%y"`.

```{r scales-25, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r scales-25-hint-1, eval = FALSE}

```

### 

The argument `date_labels` takes a format specification, in the same form as `parse_datetime()`. This plot shown here shows when each US president started and ended their term.

## Legend Layout
### 

In this section we will learn how to adjust the placement of the legend and how to customize the legend of your plot.

### Exercise 1

First create a new variable called `base`. Set `base` equal to the dataset `mpg`. (Add your code before `base` displayed below)

```{r legend-layout-1, exercise = TRUE}

base
```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r legend-layout-1-hint-1, eval = FALSE}
base <- mpg
```

### Exercise 2

Using your previous code, create a new pipeline and pipe `mpg` to the `ggplot()` function. Within this function map `x` to `displ` and `y` to `hwy`. (Add your code before `base` displayed below)

```{r legend-layout-2, exercise = TRUE}

base
```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r legend-layout-2-hint-1, eval = FALSE}
base <- mpg |> 
  ggplot(aes(x = ..., y = ...))
```

### Exercise 3

Using your previous code, add the `geom_point()` function to the pipeline. Within this newly added function map `color` to `class`. (Add your code before `base` displayed below)

```{r legend-layout-3, exercise = TRUE}

base
```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r legend-layout-3-hint-1, eval = FALSE}
base <- mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point(aes(color = ...))
```

### 

To control the overall position of the legend, you need to use a theme() setting. The theme setting legend.position controls where the legend is drawn. The default is `legend.position = "right"`. 

### Exercise 4

Using your previous code, add the `theme()` function to the pipeline. Within this function, add the `legend.position` argument and set it equal to `"left".` (Add your code before `base` displayed below)

```{r legend-layout-4, exercise = TRUE}

base
```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r legend-layout-4-hint-1, eval = FALSE}
base <- mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point(aes(color = ...)) +
  theme(legend.position = "left")
```

### 

As you can see, the legend's position is now to the left of the plot.

### Exercise 5

Using your previous code, within your call to the function `theme()` change the argument's definition from `"left"` to `"top"`. (Add your code before `base` displayed below)

```{r legend-layout-5, exercise = TRUE}

base
```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r legend-layout-5-hint-1, eval = FALSE}
base <- mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point(aes(color = ...)) +
  theme(legend.position = "top")
base
```

### 

We can see that the legend is taking too much space at the top of the plot. So let's adjust the way the legend is displayed.

### Exercise 6

Using your previous code, add the `guides()` function to the pipeline. Within this function, add the `color` argument and set it equal to `guide_legend(nrow = 3)`. (Add your code before `base` displayed below)

```{r legend-layout-6, exercise = TRUE}

base
```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r legend-layout-6-hint-1, eval = FALSE}
base <- mpg |> 
  ggplot(aes(x = ..., y = ...)) +
  geom_point(aes(color = ...)) +
  theme(legend.position = "top") +
  guides 
```

### 

This fixes our previous problem. If your plot is short and wide, place the legend at the legend at the top or bottom, and if it’s tall and narrow, place the legend at the left or right. You can also use legend.position = "none" to suppress the display of the legend altogether.






<!-- DK: Comments from old material, which was Wrangling: More Plots from all.primer.tutorials. May no longer apply. -->

<!-- Commented out More Babynames. It was producing a hard to fix error. Also, it is a bit sloppy. I would like to add it back since I want to show students things like ggplotly() and animation. -->

<!-- Difficult to understand what a geom_density shows, especially the meaning of the y-axis. Maybe we should have a section which walks students through the concepts of a distribution, ending with a smooth probability distribution. First, start with a geom_histogram example, but which looks like a standard plot. Or, maybe just use facet_wrap, stack them on top of each other. Raw counts of things are important. Second, use the same data, turns it into percentages using the after_stat() trickery. Third plot, use the same data, does this with geom_density(). Just an easier way of showing those shapes. Fourth plot, same data, use stat_slab().  BL: Is this already done? -->


<!-- Five examples, each of which needs to use pivot_longer (if needed) to put things in the same column and which then creates a "standard" plot with different levels on the y-axis. Those levels sometimes already exist in the data, like trains$party, and sometimes need to be created, like turning trains$income into 5 categories. [two use pivot_longer, somewhat unecessarily in shaming?. Those that do not use pivot_longer use mutate
to make groups and (one) to transform these group into factors as their "hard" wrangling technique.] -->

<!-- Use stuff other than stat_slab() for variety sake. Use geom_density in the first plot, maybe. And then geom_histogram() in the second plot, maybe with the same data! [see comment 4]  -->

<!-- Drop knuggets of wisdom about what these densities mean. Sometimes they are scaled and sometimes not. [see comment 3] -->

<!-- Example with trains which needs to get att_end and att_start in the same column so that you can plot them together with fill or whatever. [This may have been a better use of pivot_longer...] -->

<!-- Example with trains which transform income into a set of categories, as in class. [not done with trains, but see comment 6]  -->

<!-- Change phrasing of ggplot geom exercises -->

<!-- Is shaming too big since it makes it a 10 second step everytime you run the pipe? -->

## National Health and Nutrition Survey
### 

`nhanes` includes data from the "National Health and Nutrition Examination Survey," which contains the personal and physical information of 10,000 Americans from two surveys in 2009 and 2011.

### 

Let's create the following plot.

```{r}
nhanes_p1 <- nhanes |> 
  select(bmi, gender, depressed) |> 
  drop_na(depressed, bmi) |> 
  ggplot(aes(x = bmi, fill = gender)) +
  geom_histogram(alpha = .5, bins = 100, position = "identity") +
  facet_wrap(~ depressed) +
  coord_cartesian(xlim = c(16, 60)) +
  labs(title = "BMI and Days Depressed",
       subtitle = "Most participants reported not feeling depressed at all", 
       x = "BMI", 
       y = "Depression", 
       fill = "Sex",
       caption = "National Health and Nutrition Examination Survey") +
  theme_classic() 

nhanes_p1
```

### Exercise 1

Look at the help page for `nhanes`.

```{r national-health-and--1, exercise = TRUE}

```

```{r national-health-and--1-hint-1, eval = FALSE}
?nhanes
```

### 

The 10,000 units (people) in the tibble are the equivalent of a random sample of 10,000 US residents.


### Exercise 2

Use the function `skim()` on the `nhanes` data set.

```{r national-health-and--2, exercise = TRUE}

```

```{r national-health-and--2-hint-1, eval = FALSE}
skim(...)
```

### 

Note that `depressed` is a factor. 

### Exercise 3

Start a pipe with the `nhanes` data set and `select()` the `gender`, `depressed`, and `bmi` columns.

```{r national-health-and--3, exercise = TRUE}

```

```{r national-health-and--3-hint-1, eval = FALSE}
... |>
  select(..., ..., ...)
```

### Exercise 4

We can see that there are some NA values in `nhanes`. Ideally, we want to get rid of NA values. Start a pipe with `nhanes`. `select()` the three columns. Then use the function `drop_na()` to remove all NA values with the columns as the argument.

```{r national-health-and--4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>


```{r national-health-and--4-hint-1, eval = FALSE}
... |>
  drop_na(..., ...)
```

### 

If we had not selected relevant columns before we dropped na values, observations with NA values in columns we don't care about would also be dropped, causing uncessary loss of data.

### Exercise 5

Now it's time to graph it. Continue piping your code with `ggplot()`. Inside `aes()`, map `bmi` to the x-axis, and `gender` to `fill`. Finally, add the layer `geom_histogram()`.

```{r national-health-and--5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--5-hint-1, eval = FALSE}
... |> 
  ggplot(mapping = aes(x = ..., 
                        fill = ...)) +
  geom_histogram()
```

### 

Remember that histogram has a default `y` which are the counts it tabulates for each bin from our data. 

### Exercise 6

Within `geom_histogram()`, set the argument `position` equal to "identity", set the argument `alpha` = `0.5`, and set the argument `bins` = 100. 

```{r national-health-and--6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--6-hint-1, eval = FALSE}
... |> 
  geom_histogram(position = "...", alpha =  ..., 
                        bins = ...)) 
```

### 

For histogram and bar plots, `position` is by default "stacked", which stacks different colors of the same x value on top of one another. `position` being equal to "identity", makes it so that different colors overlap, which can be seen when the opacity of the colors is increased. 

### Exercise 7

Add the layer `facet_wrap()` to facet the histogram by `depressed`. 

```{r national-health-and--7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>


```{r national-health-and--7-hint-1, eval = FALSE}
Within facet_wrap(), remember to put a ~ before the variable you want to facet by.
```

```{r national-health-and--7-hint-2, eval = FALSE}
... + 
  facet_wrap(~...) 
```

### 

Facet wrapping keeps the same y axis scale, which allows us to compare the sizes of data we have for each level of Depressed

### Exercise 8

Using the code you created above, add the layer `coord_cartesian()` and  set the argument `xlim` equal to the vector `c(16, 60)`, which limits the x-axis domain to a minimum of 16 and a maximum of 60. 


```{r national-health-and--8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>


```{r national-health-and--8-hint-1, eval = FALSE}
... +
  coord_cartesian(xlim = c(...,...))
```

### Exercise 9

Let's clean the graph up by adding the theme `theme_classic() `.

```{r national-health-and--9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>


```{r national-health-and--9-hint-1, eval = FALSE}
Recall that when you add a theme, you add a layer! 
Use the + operator.
```

```{r national-health-and--9-hint-2, eval = FALSE}
... +
  theme_classic() 
```

### Exercise 10

To finish your plot, add the layer `labs()` to give the graph a title, subtitle, axis labels, legend heading, and caption. To change the legend heading from the name of the tibble column, use the argument `fill`. 

```{r national-health-and--10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--10-hint-1, eval = FALSE}
... +
  labs(title = "..." ,
      subtitle = "...",
      x = "...",
      y = "..."
     fill = "...",
     caption = "...")
```

Reminder: This is what your plot should look like.

```{r nhanes9-answer}
nhanes_p1
```

### Exercise 11

The histogram plots the actual counts for each BMI bin, and the categories of Depressed with more data are taller. Other functions can plot probabilities for each bin, i.e. the count for each bin divided by the sum of the counts in all a graph's bin.

### 

Let's make the following plot.

```{r national-health-and--11}
nhanes_p2 <- nhanes |> 
  select(bmi, gender, depressed) |> 
  drop_na(depressed, bmi) |> 
  ggplot(aes(x = bmi, fill = gender)) +
  geom_density(alpha = .5)  +
  facet_wrap(~ depressed) +
  coord_cartesian(xlim = c(16, 60)) +
  labs(title = "BMI and Days Depressed",
       subtitle = "Depressed females who answered 'Most' are heavier than depressed males who answered 'Most'", 
       x = "BMI", 
       y = "Density", 
       fill = "Sex",
       caption = "National Health and Nutrition Examination Survey") +
  theme_classic() 

nhanes_p2
```

### 

We have provided you with the beginning of code for the last plot. Continue your pipe by adding `ggplot()`. Map `bmi` to the x-axis, and `gender` to `fill`. Add the layer `geom_density()`.  Within `geom_density()`, set `alpha` = .5.

```{r nhanes10, exercise = TRUE}
 nhanes |> 
  select(bmi, gender, depressed) |> 
  drop_na(depressed, bmi)
```

```{r national-health-and--11-hint-1, eval = FALSE}
... |> 
ggplot(mapping = aes(..., fill = ...)) +
  geom_density(alpha = ...) 
```

### 

In addition to plotting probabilities instead of counts, `geom_density()` smooths out the histogram. 

### Exercise 12

Using the code above, add the layer `facet_wrap()` to facet the histogram by `depressed`. 

```{r national-health-and--12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--12-hint-1, eval = FALSE}
Within facet_wrap(), remember to put a ~ before the variable you want to facet by.
```

```{r national-health-and--12-hint-2, eval = FALSE}
... + 
  facet_wrap(~...) 
```

### 

Facet wrapping keeps the same y axis scale, which allows us to compare the sizes of data we have for each level of Depressed

### Exercise 13

Add the layer `coord_cartesian` and  set the argument `xlim` equal to the vector `c(16, 60)`, which limits the x-axis domain to a minimum of 16 and a maximum of 60. 

```{r national-health-and--13, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--13-hint-1, eval = FALSE}
... +
  coord_cartesian(xlim = c(...,...))
```

### Exercise 14

Add the layer `theme_classic() ` to adjust the feel of your plot. Finally, add labels to your graph. Pay particular attention to how the y-axis label and subtitle should change compared to the previous plot. 

```{r national-health-and--14, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--14-hint-1, eval = FALSE}
... +
  theme_classic()  +
  labs(title = "..." ,
       subtitle = "...",
       x = "...",
       y = "...",
     fill = "...",
     caption = "...")

```

Reminder: This is what your plot should look like.

```{r nhanes13-answer}
nhanes_p2
```

### Exercise 15

In the exercises above, we facet wrapped the graphs for the three Depressed categories using a Density curve. However, our curves were vertical. Density curves and their distribution are so much easier to look at when compared along the x-axis. Let's do that.


### 

Let's make the following plot.

```{r national-health-and--15}
nhanes_p3 <- nhanes |> 
  select(bmi, gender, depressed) |> 
  drop_na(depressed, bmi) |> 
  ggplot(aes(x = bmi, y = depressed, fill = gender)) +
  stat_slab(alpha = .5)  +
  coord_cartesian(xlim = c(16, 50)) +
  scale_y_discrete(labels = c("No Days", "Several Days", "Most Days")) +
  labs(title = "BMI and Days Depressed",
       subtitle = "Most often depressed females have highest BMI among both sexes", 
       x = "BMI", 
       y = "Days Depressed", 
       fill = "Sex",
       caption = "National Health and Nutrition Examination Survey") +
  theme_classic() 

nhanes_p3
```

### 

We have provided you with the beginning of code for the last plot. Continue your pipe with `ggplot()`. Map `bmi` to the x-axis, `depressed` to the y-axis, and `gender` to `fill`. Add the layer `stat_slab()`.  Within `stat_slab()`, set `alpha` = .5. 

```{r nhanes14, exercise = TRUE}
 nhanes |> 
  select(bmi, gender, depressed) |> 
  drop_na(depressed, bmi) 
```

```{r national-health-and--15-hint-1, eval = FALSE}
... |> 
ggplot(aes(x = , y = , fill = ...)) +
  stat_slab(alpha = ...) 
```

### 

Notice that adding `depressed` to the y-axis has done something similar to what faceting did in our previous graphs. Stacking in this method can be done with `stat_slab()` which is part of the package `ggdist`. 

### Exercise 16

Add the layer `coord_cartesian`. Let's alter our maximum to 50 so that we get a better focus on the peaks of the graph. Set `xlim` equal to the vector `c(16, 50)`, which limits the x-axis domain to a minimum of 16 and a maximum of 50. 

```{r national-health-and--16, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--16-hint-1, eval = FALSE}
... +
  coord_cartesian(xlim = c(...,...))
```

### Exercise 17

Add the layer `scale_y_discrete()`. Set the argument `labels` equal to a vector of strings `c("No Days", " Several Days", "Most Days")`. 

```{r national-health-and--17, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--17-hint-1, eval = FALSE}
  ... +
  scale_y_discrete(labels = ...) +
  ... +
```

```{r national-health-and--17-hint-2, eval = FALSE}
  ... +
  scale_y_discrete(labels = c("No Days", "Several Days", "Most Days")) +
  ... +
```

### 

The vector renames the y-axis breaks from bottom to top based on the respective names given in the vector.

We use discrete because the y-axis measures discrete, as opposed to continuous or binned, variables.

### Exercise 18

Let's clean the graph up by adding the layer `theme_classic() `. Now add the `labs()` layer. As you set the labels, pay particular attention to how the y-axis label and subtitle should change compared to the previous plot. 

```{r national-health-and--18, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>


```{r national-health-and--18-hint-1, eval = FALSE}
... +
  theme_classic() +
  labs(title = "...",
       subtitle = "...", 
       x = "...", 
       y = "...", 
       fill = "...",
       caption = "...")

```

Reminder: This is what your plot should look like.

```{r nhanes17-answer}
nhanes_p3
```


## Babynames
### 

The `babynames` data set comes from the SSA (Social Security Administration). After 1986, all baby's were required to be given a social security number. This data contains all the names, year born, and sex of the babies. The number of names is counted and is converted into a proportion. We will be using this data to analyze the popularity of top 10 names each year.

### 

Let's create this graph

```{r}
baby_p <- babynames |>
  top_n(n = 10, wt = prop) |>
  filter(! (year == 1887 & name == "Robert")) |>
  summarise(total = sum(prop), .by = c(sex, year)) |>
  ungroup() |> 
  ggplot(mapping = aes(x = year, y = total, color = sex)) +
    geom_line() +
    scale_y_continuous(labels = scales::percent) +
    labs(title = "Total popularity of top 10 names each year, by sex",
         x = "Year",
         y = "Percentage of top 10 names of all names") +
  theme_classic()

baby_p
```

### Exercise 1

Look at the help page for `babynames`

```{r babynames-1, exercise = TRUE}

```

```{r babynames-1-hint-1, eval = FALSE}
?babynames
```

### 

### Exercise 2

`skim` the `babynames` dataset

```{r babynames-2, exercise = TRUE}

```

```{r babynames-2-hint-1, eval = FALSE}

skim(...)
```

### 

Note that we have no missing values.

### Exercise 3

Print out `babynames`

```{r babynames-3, exercise = TRUE}

```

```{r babynames-3-hint-1, eval = FALSE}
babynames
```

### 

There are about 1,924,655 rows meaning that there are 1,924,655 baby names in the data set. 

### Exercise 4

Start with a new pipeline to `babynames` and use the `top_n()` function so that we only take the top 10 names of each group that we made. To do this, add the `n` and `wt` argument within the function and set `n` to `10` and `wt` to `prop`.

```{r babynames-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r babynames-4-hint-1, eval = FALSE}
... |>
  top_n(..., wt = prop)
```

### Exercise 5

Continue your pipe with the `summarise()` function. Within this function, create a new variable called `total` and set it to `n()`. Afterwards group by `sex` and `year` using the `.by` argument

```{r babynames-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r babynames-5-hint-1, eval = FALSE}
...|>
  summarise(total = ..., .by = c(sex, year))
```

### 

When we do this, we again see that there isn't the correct amount of rows. Something is wrong with our data. There might be a tie somewhere between the proportion of two names. This would cause there to be an extra row in that group.

### Exercise 6

Let's find out which group it is. Use the `arrange` function to see the total row in a descending order.

```{r babynames-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r babynames-6-hint-1, eval = FALSE}
... |>
  arrange(desc(...))
```

### 

We see that the year 1887 for male names has an extra row somewhere. There's our problem. Let's go back into the data set and look into that group.

### Exercise 7

Start a new pipe with the `babynames` data. Use the `top_n()` function to obtain the top 10 names. (Use the same code from previous exercises) Then filter out the year 1887 and the male names.

```{r babynames-7, exercise = TRUE}

```

```{r babynames-7-hint-1, eval = FALSE}
... |>
  top_n(10, wt = prop) |>
  filter(... == 1887 & sex == "...")
```

### 

We now see that Edward and Robert have the same prop at 0.0194. This is what's messing it up. Time to chose the better name. Pick which name you like better.

### Exercise 8

Now continue your pipe with `filter` again; however, we are trying to remove that one piece of data. Go ahead and remove the name you least like.

```{r babynames-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r babynames-8-hint-1, eval = FALSE}

Remember we can use the ! to indicate that we want to remove something
  
```

```{r babynames-8-hint-2, eval = FALSE}
... |>
  top_n(10, wt = prop) |>
  filter(... == 1887 & sex == "...") |>
  filter(! (... == 1887 & name == "..."))
```

### Exercise 9

Now use `summarise()` to see the total proportion of top 10 names each year

```{r babynames-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r babynames-9-hint-1, eval = FALSE}
... |>
  summarise(total = sum(prop))
```

### 

Now we see that we have taken out that one tie and our row count has gone down

### Exercise 10

Using your previous code, within your call to the summarise() function add the `.by` argument so that you can groupn by the variables `sex` and `year`. 

```{r babynames-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r babynames-10-hint-1, eval = FALSE}
... |> 
  summarise(total = ..., .by = c(...))
```

### Exercise 11

Time to graph it. But we don't only want to graph the year 1887, so remove the first `filter` function which should be the one without the !. Continue your pipe with `ggplot`. Map `year` to the x-axis, `total` to the y-axis, and `sex` to color. Since we want it to be a line graph, use `geom_line()`.

```{r babynames-11, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r babynames-11-hint-1, eval = FALSE}
...|>
  ggplot(mapping = aes(x = ..., y = ..., color = ...)) +
  geom_line()
```

### Exercise 12

To finish your plot, use `labs()` to give the graph a title, subtitle, and axis labels. Add `theme_classic()` to adjust the feel of the graph.

```{r babynames-12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r babynames-12-hint-1, eval = FALSE}
... 
ggplot(mapping = aes(x = ..., y = ..., color = ...)) +
  geom_line() +
  labs(...)
```

Reminder: This is what your plot should look like.

```{r show-baby}
baby_p
```

### 

After looking at all the graphs info, we can see that the overall trend of this data goes down over time as the years increase. This makes sense. As society has grown overtime, the idea and concept of freedom, expression of creativity, and not following the crowd has become a bigger part. I mean, think about it. You have Cardi B naming her child Kulture, Kim K naming her daughter North. A literal direction. Her sister Chloe with her daughter named True. And last but not least, Elon Musks's son called X Æ A-12 or "Ash". Nice one Elon. I better not see you naming your child, if you choose to have them, Febreeze or something.




## Summary
### 

This tutorial covered [Chapter 12: Communication](https://r4ds.hadley.nz/communication.html) from [*R for Data Science (2e)*](https://r4ds.hadley.nz/) by Hadley Wickham, Mine Çetinkaya-Rundel, and Garrett Grolemund. You learned how to use [**ggplot2**](https://ggplot2.tidyverse.org/) and related packages to create persuasive graphics.


```{r download-answers, child = system.file("child_documents/download_answers.Rmd", package = "tutorial.helpers")}
```
